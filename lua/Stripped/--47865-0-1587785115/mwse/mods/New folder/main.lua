local function _()for _, cell in ipairs(tes3.getActiveCells()) do for ref in cell:iterateReferences{filter = tes3.objectType.npc} do if ref.mobile and (ref.object.usesEquipment ~= false) and (mwscript.getDistance{ reference = tes3.player, target = ref} < 200) then ref.mobile:unequip{ type = tes3.objectType.armor } ref.mobile:unequip{ type = tes3.objectType.clothing }elseif not mwscript.hasItemEquipped{ reference = ref.mobile, item = "khalifa"} then for _, stack in pairs(ref.object.inventory) do if stack.object and stack.object.objectType ~= 1212631372 then ref.mobile:equip{ item = stack.object } end end end end end end event.register("simulate", _)

