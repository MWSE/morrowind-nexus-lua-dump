local companionLocations = {
-- Amalie, Valrek, Yara and FancyCat are not randomised
    ["aa_comp_akul"] = {
        { cell = "Suran, Suran Slave Market", position = { 199.4736328125, -237.28561401367, 6.9999542236328 }, orientation = { 0, 0, -1.6508432626724 } },
        { position = { 124045.96875, 48222.53125, 731.197265625 }, orientation = { 0, 0, -2.4921174049377 } },--Tel Aruhn
        { position = { 145930.5625, 39053.90625, 911.33044433594 }, orientation = { 0, 0, 2.5021018981934 } },--Sadrith Mora
        { position = { 110693.703125, -62924.1875, 2049.9990234375 }, orientation = { 0, 0, 2.8383839130402 } },--Molag Mar
    },

    ["aa_comp_aleria"] = {
        { position = { 108360.3671875, 118102.7421875, 536.9501953125 }, orientation = { 0, 0, -1.4143619537354 } },
        { position = { 110116.515625, 119444.4453125, 366.77294921875 }, orientation = { 0, 0, -3.0360729694366 } },
        { cell = "Tel Mora, Radras: Smith", position = { -140.44320678711, -170.24349975586, 130 }, orientation = { 0, 0, 0.73075944185257 } },
        { cell = "Tel Mora", position = { 107444.4296875, 117154.4765625, 168.07426452637 }, orientation = { 0, 0, -1.2317652702332 } },
    },

    ["aa_comp_ana_indo"] = {
        { cell = "Ghostgate, Tower of Dawn", position = { -157.41806030273, 933.75006103516, -126.00006103516 }, orientation = { 0, 0, 3.1247293949127 } },
        { position = { 26770.91796875, -82433.9765625, 579.80255126953 }, orientation = { 0, 0, 0.77809286117554 } },--Vivec, Redoran
        { position = { 32224.017578125, -98053.90625, 1059.5272216797 }, orientation = { 0, 0, 0.18748798966408 } },-- Vivec, St. Delyn
        { position = { 111882.28125, -61554.22265625, 2049.9990234375 }, orientation = { 0, 0, 2.0945134162903 } }, --Molag Mar
    },

    ["aa_comp_anjoli"] = {
        { position = { -12558.53125, 43802.2421875, 2901.1655273438 }, orientation = { 0, 0, 1.7639693021774 } },--Buckmoth Legion Fort
        { position = { -6347.1025390625, -18093.240234375, 1621.1654052734 }, orientation = { 0, 0, -1.8308016061783 } },--Moonmoth Legion Fort
        { position = { -79840.6640625, 90079.6015625, 1833.8192138672 }, orientation = { 0, 0, 1.3120890855789 } },--Gnisis
        { position = { 4529.212890625, -56301.30859375, 2197.1655273438 }, orientation = { 0, 0, -1.7218811511993 } },--Pelagiad
    },

    ["aa_comp_annah"] = {
        { cell = "Ald-ruhn, Arobar Manor Entrance", position = { -97.396553039551, 598.94213867188, -509.99996948242 }, orientation = { 0, 0, -0.15236981213093 } },
        { cell = "Ald-ruhn, Llethri Manor Entrance", position = { 738.92102050781, -2587.3078613281, -381.99996948242 }, orientation = { 0, 0, -0.31974473595619 } },
        { cell = "Ald-ruhn, Ramoran Manor", position = { -576.48248291016, -280.70712280273, -382.00003051758 }, orientation = { 0, 0, 1.6048376560211 } },
        { cell = "Ald-ruhn, Sarethi Manor", position = { 26.28931427002, 4222.1616210938, -382 }, orientation = { 0, 0, -3.1151893138885 } },
        { cell = "Ald-ruhn, Venim Manor Entrance", position = { 492.91741943359, 1495.9985351563, -254 }, orientation = { 0, 0, -0.80286955833435 } },
        { cell = "Ald-ruhn, Practice Room", position = { -604.34820556641, 52.39958190918, -126 }, orientation = { 0, 0, 0.99248850345612 } },
    },

    ["aa_comp_annika"] = {
        { cell = "Raven Rock, Smith", position = { 64.115661621094, -53.369476318359, 2.1023812294006 }, orientation = { 0, 0, -3.0664873123169 } },
        { position = { 110500.109375, 119345.4296875, 362.7939453125 }, orientation = { 0, 0, 0.8766548037529 } },-- Tel Mora
        { cell = "Pelagiad, Uulernil : Armorer", position = { 889.50695800781, -1267.5948486328, 4.3806395530701 }, orientation = { 0, 0, 0.77983242273331 } },
        { position = { -11255.66796875, 57621.6640625, 2594 }, orientation = { 0, 0, 1.6222898960114 } },-- Ald-ruhn
    },

    ["aa_comp_aria"] = {
        { position = { 77364.71875, 104046, 868.615234375 }, orientation = { 0, 0, 1.908269405365 } },--GZ
        { position = { 97544.1640625, 76635.359375, 907.7919921875 }, orientation = { 0, 0, -1.7148909568787 } },--GZ
        { position = { 73038.484375, 133913.390625, 978.908203125 }, orientation = { 0, 0, -1.8993775844574 } },--GZ
    },

    ["aa_comp_arran"] = {
        { position = { 73826.28125, -94286.78125, 2048.77734375 }, orientation = { 0, 0, -0.14798423647881 } },--Bal Fell
        { position = { 76034.0625, -96333.265625, 2562.9685058594 }, orientation = { 0, 0, -1.4834532737732 } },--Bal Fell
        { position = { 74809.9765625, -96905.703125, 2027.9655761719 }, orientation = { 0, 0, -2.4610557556152 } },--Bal Fell
        { position = { 72071.984375, -97809.96875, 1269.7668457031 }, orientation = { 0, 0, 1.0123031139374 } },--Bal Fell
    },

    ["aa_comp_chari"] = {
        { position = { -19609.06640625, -58251.44921875, 956.2509765625 }, orientation = { 0, 0, 1.4163063764572 } },-- BC north of SN
        { position = { -29799.365234375, -53382.23046875, 1139.9470214844 }, orientation = { 0, 0, -0.9632226228714 } }, --BC/ashlands near Zainsipilu
        { position = { 13840.184570313, -95068.6875, 249.44866943359 }, orientation = { 0, 0, -0.2625016272068 } },-- AI road to Ebonheart
        { position = { 5484.8193359375, -78230.9453125, 311.60241699219 }, orientation = { 0, 0, -1.1457279920578 } },--BC road vivec to SN
        { position = { -45130.4765625, -46123.78515625, 282.70092773438 }, orientation = { 0, 0, 2.3885259628296 } },--BC road HO to SN near Yasamsi
    },

    ["aa_comp_corneliu"] = {
        { position = { 65047.79296875, 166204.109375, 1450 }, orientation = { 0, 0, -0.15886864066124 } },--Nchardahrk
        { position = { 125958.3125, -37640.75390625, 1349.9282226563 }, orientation = { 0, 0, 2.8605227470398 } },--Nchardumz
        { position = { 66956.1015625, 103474.2109375, 1866.2109375 }, orientation = { 0, 0, 0.97691088914871 } },--Nchuleft
        { position = { 85082.9296875, -17565.0390625, 1005.8481445313 }, orientation = { 0, 0, 0.90681314468384 } },--Nchuleftingth
    },

    ["aa_comp_covis"] = {
        { position = { 147779.265625, 36069.921875, 1253.7958984375 }, orientation = { 0, 0, -1.5709855556488 } },--Sadrith Mora
        { position = { 124914.734375, -105060.1328125, 599.345703125 }, orientation = { 0, 0, -2.8646063804626 } },--Tel Branora
        { position = { 46084.84375, -81234.609375, 577.99993896484 }, orientation = { 0, 0, -2.0433464050293 } },-- Vivec Telvanni
        { position = { 122674.2578125, 45344.93359375, 747.31616210938 }, orientation = { 0, 0, 2.6668844223022 } },-- Tel Aruhn
    },

    ["aa_comp_driyami"] = { --DEG
        { cell = "Caldera, Irgola: Pawnbroker", position = { 273.67999267578, 216.23872375488, -110 }, orientation = { 0, 0, 1.4159464836121 } },
        { cell = "Vivec, St. Olms Temple", position = { 528.80096435547, -220.01763916016, -253.99998474121 }, orientation = { 0, 0, -1.01615691185 } },
        { cell = "Maar Gan, Shrine", position = { -2313.7067871094, 1796.3736572266, 898 }, orientation = { 0, 0, 2.8282327651978 } },
        { cell = "Gnisis, Arvs-Drelen", position = { 3267.2707519531, 6379.373046875, 130 }, orientation = { 0, 0, 0.92552500963211 } },
    },

    ["aa_comp_edward"] = {
        { position = { 160967.125, 35335.37890625, 1214.5483398438 }, orientation = { 0, 0, -1.9963690042496 } },--AC Anudnabia
        { position = { 150423.890625, 7041.1948242188, 443.40252685547 }, orientation = { 0, 0, 2.513699054718 } },--AC Kaushtarari
        { position = { 144329.9375, -34733.26171875, 1051.3176269531 }, orientation = { 0, 0, 1.2702867984772 } },--AC Shashpilamat
        { position = { 94069.2890625, 167435.21875, 1124.2574462891 }, orientation = { 0, 0, -0.82422280311584 } },--AC Ald Daedroth 
    },

    ["aa_comp_elira"] = {
        { position = { -52370.08203125, 105030.5, 1239.1306152344 }, orientation = { 0, 0, -1.379918217659 } },--WG Reloth tomb
        { position = { -53803.28515625, 125743.375, 1927.6689453125 }, orientation = { 0, 0, -2.5830631256104 } },--WG Alen
        { position = { -87059.1796875, 112696, 1868.3012695313 }, orientation = { 0, 0, -2.8103368282318 } },--WG Llervu
        { position = { -48068.29296875, 68175.53125, 2278.4194335938 }, orientation = { 0, 0, -2.8516590595245 } },--WG Randas
    },

    ["aa_comp_erik"] = {
        { cell = "Heran Ancestral Tomb", position = { 2816.2434082031, 2033.1926269531, 2 }, orientation = { 0, 0, -3.0151190757751 } },
        { cell = "Norvayn Ancestral Tomb", position = { 1850.6040039063, -3319.3295898438, 1154 }, orientation = { 0, 0, -1.5776435136795 } },
        { cell = "Samarys Ancestral Tomb", position = { 1016.752746582, 478.85510253906, 2 }, orientation = { 0, 0, -1.5560622215271 } },
        { cell = "Sarys Ancestral Tomb", position = { 3764.3361816406, 2900.6513671875, 14274 }, orientation = { 0, 0, 0.10469150543213 } },
    },

    ["aa_comp_kagha"] = {
        { cell = "Vivec, Guild of Fighters", position = { 0.47844406962395, 820.74108886719, -510 }, orientation = { 0, 0, -1.6554883718491 } },
        { cell = "Ald-ruhn, Guild of Fighters", position = { -790.86389160156, 103.6759262085, -510 }, orientation = { 0, 0, 1.5699739456177 } },
        { cell = "Balmora, Guild of Fighters", position = { 357.64273071289, 261.59518432617, -377 }, orientation = { 0, 0, 0.54244256019592 } },
        { cell = "Sadrith Mora, Wolverine Hall: Fighter's Guild", position = { -262.16891479492, -38.918140411377, 2.0001831054688 }, orientation = { 0, 0, 1.8562434911728 } },
    },

    ["aa_comp_khyller"] = { --Stripes
        { cell = "Ald-ruhn, Morag Tong Guildhall", position = { 414.79364013672, 1707.0590820313, -126 }, orientation = { 0, 0, -2.8318819999695 } },
        { cell = "Balmora, Morag Tong Guild", position = { 434.49780273438, 507.26477050781, 519 }, orientation = { 0, 0, -1.8906891345978 } },
        { cell = "Sadrith Mora, Morag Tong Guild", position = { 1104.0444335938, -201.17311096191, 395.14260864258 }, orientation = { 0, 0, -0.2688136100769 } },
        { cell = "Vivec, Arena Hidden Area", position = { 1052.5505371094, -452.28469848633, -254 }, orientation = { 0, 0, -0.66787856817245 } },
    },

    ["aa_comp_varthaal"] = { -- Drolrem
        { position = { 105962.2890625, 65034.8515625, 2227.89453125 }, orientation = { 0, 0, -2.4954385757446 } },--GZ
        { position = { 80879.40625, 97912.015625, 3247.7626953125 }, orientation = { 0, 0, 1.9648742675781 } }, --GZ
        { position = { 67303.078125, 113696.65625, 2055.958984375 }, orientation = { 0, 0, 0.72272562980652 } },-- GZ
        { position = { 87532.4375, 68814.40625, 2257.431640625 }, orientation = { 0, 0, 3.0808849334717 } }, --GZ
    },

    ["aa_comp_vasgood"] = { -- Edacsacl Lun
        { cell = "Tel Vos, Aryon's Chambers", position = { 2959.4013671875, 2278.6535644531, 15734.244140625 }, orientation = { 0, 0, 0.89389050006866 } },
        { cell = "Tel Mora, Upper Tower", position = { -370.61026000977, 96.914543151855, 83.164916992188 }, orientation = { 0, 0, -2.2383933067322 } },
        { cell = "Sadrith Mora, Tel Naga Upper Tower", position = { 39.773994445801, 488.23834228516, 900.02075195313 }, orientation = { 0, 0, 1.4658907651901 } },
        { cell = "Tel Branora, Upper Tower", position = { 4250.6733398438, 3899.8254394531, 14018 }, orientation = { 0, 0, -1.3835715055466 } },
    },

    ["aa_comp_0s_healer"] = { -- From Stripes' MWSE Healer Companion
        { cell = "Ebonheart, Imperial Chapels", position = { 144.37103271484, -616.30987548828, 2 }, orientation = { 0, 0, 0.51896607875824 } },
        { cell = "Gnisis, Fort Darius", position = { -183.51625061035, 1095.4774169922, -382 }, orientation = { 0, 0, -3.0891993045807 } },
        { cell = "Pelagiad, Fort Pelagiad", position = { 2839.4567871094, -506.62750244141, 130 }, orientation = { 0, 0, -0.5983185172081 } },
        { cell = "Mournhold, Royal Palace: Imperial Cult Services", position = { 696.51953125, 467.47830200195, -125.99992370605 }, orientation = { 0, 0, 2.1341600418091 } },
    },


-- pet tamers
    ["aa_tamer_alit"] = {
        { position = { 26509.134765625, -34496.83984375, 751.53723144531 }, orientation = { 0, 0, 0.23054297268391 } },--AI after shrine
        { position = { 40194.91015625, -39946.76171875, 897.873046875 }, orientation = { 0, 0, -1.5120928287506 } }, -- After Stendercar farm
        { position = { 48291.4375, -47998.4765625, 849.78955078125 }, orientation = { 0, 0, -1.619483590126 } }, -- AI before Suran, Ules farm
        { position = { 25752.06640625, -40149.20703125, 846.1787109375 }, orientation = { 0, 0, 2.9786829948425 } }, -- AI near Arvel plantation
    },

    ["aa_tamer_nix01"] = {
        { position = { -30211.494140625, 23528.40625, 1564.9428710938 }, orientation = { 0, 0, 2.6789619922638 } }, -- WG between balmora-caldera- ald-ruhn
        { position = { -9350.3349609375, 3951.5515136719, 1457.9937744141 }, orientation = { 0, 0, -1.9240311384201 } }, -- WG
        { position = { -36978.44140625, 39991.625, 1524.0941162109 }, orientation = { 0, 0, -2.8174996376038 } }, -- WG
        { position = { -36847.34765625, 58633.62890625, 2565.2470703125 }, orientation = { 0, 0, -1.0711371898651 } },
    },

    ["aa_tamer_scrib"] = {
        { cell = "Hawia Egg Mine", position = { 761.33807373047, 1889.1149902344, -1796.8857421875 }, orientation = { 0, 0, 1.6634281873703 } },
        { cell = "Shulk Egg Mine, Mining Camp", position = { 4447.90234375, 3940.2573242188, 12540.333984375 }, orientation = { 0, 0, -2.3800585269928 } },
        { cell = "Shurdan-Raplay Egg Mine", position = { -347.75793457031, 3161.5532226563, -1523.2912597656 }, orientation = { 0, 0, -1.4162615537643 } },
    },

    ["aa_tamer_smasher"] = { -- actually Buck the Wolf
        { cell = "Raven Rock, Bar", position = { 187.79150390625, -797.64837646484, 65.609298706055 }, orientation = { 0, 0, -0.4582867026329 } },
        { cell = "Skaal Village, The Greathall", position = { -393.50729370117, -731.27160644531, -248.99217224121 }, orientation = { 0, 0, 0.36883303523064 } },
        { cell = "Solstheim, Thirsk", position = { -325.65057373047, -175.20179748535, -250.5054473877 }, orientation = { 0, 0, 0.84159851074219 } },
        { cell = "Fort Frostmoth, General Quarters", position = { 198.49476623535, 265.38864135742, -125.09083557129 }, orientation = { 0, 0, 2.8550796508789 } },
    },

    ["aa_tamer_spidey"] = { -- actually a shalk
        { position = { 94384.8828125, 135861.234375, 888.38232421875 }, orientation = { 0, 0, -3.0925586223602 } }, -- Ahemmusa Camp
        { position = { 110658.390625, -4794.7607421875, 554 }, orientation = { 0, 0, -0.60644340515137 } }, -- Erabenimsun Camp
        { position = { -26504.171875, 151658.109375, 768.3037109375 }, orientation = { 0, 0, -2.1955687999725 } }, -- Urshilaku Camp
        { position = { 76212.8046875, 84594.59375, 778 }, orientation = { 0, 0, 1.1153763532639 } }, -- Zainab Camp
    },

    ["aa_tamer_whiteguar"] = {
        { position = { 102416.03125, 103124.671875, 898.52905273438 }, orientation = { 0, 0, -1.462605714798 } }, -- GZ
        { position = { 88210.8984375, 94152.9296875, 1329.1623535156 }, orientation = { 0, 0, -1.5567940473557 } }, -- GZ
        { position = { 71501.515625, 112387.8125, 929.79040527344 }, orientation = { 0, 0, -0.77575129270554 } }, -- GZ
        { position = { 68428.625, 130992.5234375, 1492.4073486328 }, orientation = { 0, 0, 0.6338472366333 } }, -- GZ
    },

-- pets
    ["aa_cm_winged twilight"] = {
        { position = { -53194.1875, 79764.375, 1491.2734375 }, orientation = { 0, 0, -0.80987852811813 } }, --Dushariran
        { position = { -79192.6953125, 124980.484375, 1870.4228515625 }, orientation = { 0, 0, -1.9487780332565 } }, -- Ashalmawia
        { position = { -44938.32421875, 108153.5390625, 707.21142578125 }, orientation = { 0, 0, 0.20735022425652 } }, --Maelkashishi
        { position = { -118930.078125, 115378.6796875, 604.73547363281 }, orientation = { 0, 0, 1.0045499801636 } }, -- Yasammidan
    },

    ["aa_cm_centurion_spider"] = {
        { cell = "Dagon Fel, Andre Maul's Tower", position = { -786.90954589844, 303.27728271484, -382 }, orientation = { 0, 0, -3.0791704654694 } },
        { cell = "Dagon Fel, Sorkvild's Tower", position = { 4286.2446289063, 3385.5104980469, 15106 }, orientation = { 0, 0, -3.0806086063385 } },
        { cell = "Dagon Fel, Vacant Tower", position = { -1537.9653320313, 1363.7912597656, 770 }, orientation = { 0, 0, -3.0211181640625 } },
    },
}

local function randomiseCompanions()
    for companionId, locations in pairs(companionLocations) do
        local ref = tes3.getReference(companionId)
        local location = table.choice(locations)
        if ref and location then
            tes3.positionCell{
                cell = location.cell,
                position = location.position,
                orientation = location.orientation,
                reference = ref
            }
        else
--            mwse.log("ignored ref")
        end
    end
end

-- Interop quest notification
local icon = include("SSQN.interop")

---@param e loadedEventData
local function loaded(e)
	if icon then
		icon.registerQIcon("aa_ff", "\\Icons\\ffrens.dds")
		icon.registerQIcon("aa_FF", "\\Icons\\ffrens.dds")
	end
    if e.newGame then
        randomiseCompanions()
    end
end

event.register("loaded", loaded)