local aData = {
    colours = {
        BlueWyrm  = { 78 / 255, 102 / 255, 255 / 255 }
    }
}

local defaults = {
    VivecLessonsCount = 0,
    VivecLessons = {
        ["BookSkill_Athletics3"] = false,
        ["BookSkill_Alchemy4"] = false,
        ["BookSkill_Blunt Weapon4"] = false,
        ["BookSkill_Mysticism3"] = false,
        ["BookSkill_Axe4"] = false,
        ["BookSkill_Armorer3"] = false,
        ["BookSkill_Block4"] = false,
        ["BookSkill_Athletics4"] = false,
        ["BookSkill_Blunt Weapon5"] = false,
        ["BookSkill_Short Blade4"] = false,
        ["bookskill_unarmored3"] = false,
        ["bookskill_heavy armor5"] = false,
        ["BookSkill_Alteration4"] = false,
        ["bookskill_spear3"] = false,
        ["bookskill_unarmored4"] = false,
        ["BookSkill_Axe5"] = false,
        ["BookSkill_Axe5_open"] = false,
        ["bookskill_long blade3"] = false,
        ["BookSkill_Alchemy5"] = false,
        ["bookskill_enchant4"] = false,
        ["bookskill_long blade4"] = false,
        ["bookskill_light armor4"] = false,
        ["bookskill_medium armor4"] = false,
        ["bookskill_long blade5"] = false,
        ["bookskill_spear4"] = false,
        ["BookSkill_Armorer4"] = false,
        ["bookskill_sneak5"] = false,
        ["bookskill_speechcraft5"] = false,
        ["bookskill_light armor5"] = false,
        ["BookSkill_Armorer5"] = false,
        ["BookSkill_Short Blade5"] = false,
        ["BookSkill_Athletics5"] = false,
        ["BookSkill_Block5"] = false,
        ["bookskill_medium armor5"] = false,
        ["bookskill_unarmored5"] = false,
        ["bookskill_spear5"] = false,
        ["BookSkill_Mysticism4"] = false
    },
    AncestralTombCount = 0,
    AncestralTomb = {
        ["lleran ancestral tomb"] = false,
        ["othrelas ancestral tomb"] = false,
        ["sandas ancestral tomb"] = false,
        ["sarano ancestral tomb"] = false,
        ["aryon ancestral tomb"] = false,
        ["dareleth ancestral tomb"] = false,
        ["drath ancestral tomb"] = false,
        ["drinith ancestral tomb"] = false,
        ["fadathram ancestral tomb"] = false,
        ["helas ancestral tomb"] = false,
        ["indaren ancestral tomb"] = false,
        ["llando ancestral tomb"] = false,
        ["omalen ancestral tomb"] = false,
        ["rothan ancestral tomb"] = false,
        ["salvel ancestral tomb"] = false,
        ["sandus ancestral tomb"] = false,
        ["saren ancestral tomb"] = false,
        ["thalas ancestral tomb"] = false,
        ["andalen ancestral tomb"] = false,
        ["arano ancestral tomb"] = false,
        ["arenim ancestral tomb"] = false,
        ["arys ancestral tomb"] = false,
        ["baram ancestral tomb"] = false,
        ["beran ancestral tomb"] = false,
        ["dreloth ancestral tomb"] = false,
        ["hlaalu ancestral tomb"] = false,
        ["hlervi ancestral tomb"] = false,
        ["hlervu ancestral tomb"] = false,
        ["marvani ancestral tomb"] = false,
        ["omaren ancestral tomb"] = false,
        ["ravel ancestral tomb"] = false,
        ["raviro ancestral tomb"] = false,
        ["redas ancestral tomb"] = false,
        ["releth ancestral tomb"] = false,
        ["sadryon ancestral tomb"] = false,
        ["savel ancestral tomb"] = false,
        ["verelnim ancestral tomb"] = false,
        ["andrano ancestral tomb"] = false,
        ["andrethi ancestral tomb"] = false,
        ["heran ancestral tomb"] = false,
        ["norvayn ancestral tomb"] = false,
        ["samarys ancestral tomb"] = false,
        ["sarys ancestral tomb"] = false,
        ["thelas ancestral tomb"] = false,
        ["andalor ancestral tomb"] = false,
        ["aralen ancestral tomb"] = false,
        ["favel ancestral tomb"] = false,
        ["ienith ancestral tomb"] = false,
        ["nerano ancestral tomb"] = false,
        ["sethan ancestral tomb"] = false,
        ["thiralas ancestral tomb"] = false,
        ["venim ancestral tomb"] = false,
        ["alas ancestral tomb"] = false,
        ["andas ancestral tomb"] = false,
        ["andules ancestral tomb"] = false,
        ["aran ancestral tomb"] = false,
        ["arethan ancestral tomb"] = false,
        ["dulo ancestral tomb"] = false,
        ["gimothran ancestral tomb"] = false,
        ["helan ancestral tomb"] = false,
        ["maren ancestral tomb"] = false,
        ["serano ancestral tomb"] = false,
        ["vandus ancestral tomb"] = false,
        ["velas ancestral tomb"] = false,
        ["andavel ancestral tomb"] = false,
        ["dralas ancestral tomb"] = false,
        ["drethan ancestral tomb"] = false,
        ["nelas ancestral tomb"] = false,
        ["orethi ancestral tomb"] = false,
        ["sarethi ancestral tomb"] = false,
        ["senim ancestral tomb"] = false,
        ["alen ancestral tomb"] = false,
        ["falas ancestral tomb"] = false,
        ["ginith ancestral tomb"] = false,
        ["heleran ancestral tomb"] = false,
        ["hleran ancestral tomb"] = false,
        ["indalen ancestral tomb"] = false,
        ["llervu ancestral tomb"] = false,
        ["randas ancestral tomb"] = false,
        ["reloth ancestral tomb"] = false,
        ["rethandus ancestral tomb"] = false,
        ["salothan ancestral tomb"] = false,
        ["salothran ancestral tomb"] = false,
        ["seran ancestral tomb"] = false,
        ["telvayn ancestral tomb"] = false,
        ["tharys ancestral tomb"] = false,
        ["uveran ancestral tomb"] = false,
        ["veloth ancestral tomb"] = false
    },
    mineCount = 0,
    mine = {
        ["caldera mine"] = false,
        ["elith-pal mine"] = false,
        ["mausur caverns"] = false,
        ["sudanit mine"] = false,
        ["vassir-didanat cave"] = false,
        ["yanemus mine"] = false,
        ["dissapla mine"] = false,
        ["dunirai caverns"] = false,
        ["halit mine"] = false,
        ["massama cave"] = false,
        ["yassu mine"] = false,
        ["abaelun mine"] = false,
        ["abaesen-pulu egg mine"] = false,
        ["abebaal egg mine"] = false,
        ["ahallaraddon egg mine"] = false,
        ["ahanibi-malmus egg mine"] = false,
        ["akimaes-ilanipu egg mine"] = false,
        ["asha-ahhe egg mine"] = false,
        ["ashimanu egg mine"] = false,
        ["band egg mine"] = false,
        ["eluba-addon egg mine"] = false,
        ["eretammus-sennammu egg mine"] = false,
        ["gnisis, eggmine"] = false,
        ["hairat-vassamsi egg mine"] = false,
        ["hawia egg mine"] = false,
        ["inanius egg mine"] = false,
        ["madas-zebba egg mine"] = false,
        ["maelu egg mine"] = false,
        ["maesa-shammus egg mine"] = false,
        ["matus-akin egg mine"] = false,
        ["missir-dadalit egg mine"] = false,
        ["mudan-mul egg mine"] = false,
        ["panabanit-nimawia egg mine"] = false,
        ["panud egg mine"] = false,
        ["pudai egg mine"] = false,
        ["sarimisun-assa egg mine"] = false,
        ["setus egg mine"] = false,
        ["shulk egg mine"] = false,
        ["shurdan-raplay egg mine"] = false,
        ["sinamusa egg mine"] = false,
        ["sinarralit egg mine"] = false,
        ["sur egg mine"] = false,
        ["vansunalit egg mine"] = false,
        ["zalkin-sul egg mine"] = false
    },
    dunmerStrCount = 0,
    dunmerStr = {
        ["andasreth, lower level"] = false,
        ["andasreth, propylon chamber"] = false,
        ["berandas, keep, top level"] = false,
        ["berandas, propylon chamber"] = false,
        ["valenvaryon, lurog's hut"] = false,
        ["valenvaryon, lambug's hut"] = false,
        ["valenvaryon, gashna's hut"] = false,
        ["valenvaryon, durz's hut"] = false,
        ["valenvaryon, umug's hut"] = false,
        ["valenvaryon, propylon chamber"] = false,
        ["indoranyon"] = false,
        ["indoranyon, propylon chamber"] = false,
        ["kogoruhn, hall of phisto"] = false,
        ["kogoruhn, dome of pollock's eve"] = false,
        ["kogoruhn, dome of urso"] = false,
        ["kogoruhn, temple of fey"] = false,
        ["marandus, lower level"] = false,
        ["marandus, propylon chamber"] = false,
        ["rotheran, arena"] = false,
        ["rotheran, communal hut"] = false,
        ["rotheran, propylon chamber"] = false,
        ["telasero, upper level"] = false,
        ["telasero, propylon chamber"] = false,
        ["falasmaryon, lower level"] = false,
        ["falasmaryon, missun akin's hut"] = false,
        ["falasmaryon, propylon chamber"] = false,
        ["falensarano, upper level"] = false,
        ["falensarano, propylon chamber"] = false,
        ["hlormaren, keep, bottom level"] = false,
        ["hlormaren, propylon chamber"] = false
    },
}

-- взято из примера хранения данных https://mwse.github.io/MWSE/guides/storing-data/#persistent-storage-for-the-same-player-character
-- эта функция инициализирует таблицу данных tes3.player.data.
local function initTableValues(data, t)
    for k, v in pairs(t) do
         --If a field already exists - we initialized the data
         --table for this character before. Don't do anything.
        if data[k] == nil then
            if type(v) ~= "table" then
                data[k] = v
            elseif v == {} then
                data[k] = {}
            else
                -- Fill out the sub-tables
                data[k] = {}
                initTableValues(data[k], v)
            end
        end
    end
end

-- 36 Уроков Вивека.
function aData.countLessons(e)
    local myData = aData.getData()
    if (myData["VivecLessons"][e.book.id] == false) then
        myData["VivecLessons"][e.book.id] = true
        myData["VivecLessonsCount"] = myData["VivecLessonsCount"] + 1
        mwse.log("[Achievement pack] Readed Vivec Lessons: " .. e.book.id .. ". Total:" .. myData["VivecLessonsCount"] .."\\36")
        if e.book.id == "BookSkill_Axe5" then
        myData["VivecLessons"]["BookSkill_Axe5_open"] = true
        mwse.log("[Achievement pack] Readed Vivec Lessons: BookSkill_Axe5_open (open version)")
        end
        if e.book.id == "BookSkill_Axe5_open" then
        myData["VivecLessons"]["BookSkill_Axe5"] = true
        mwse.log("[Achievement pack] Readed Vivec Lessons: BookSkill_Axe5 (closed version)")
        end
    end
end

-- Эхо прошлого.
function aData.countTomb(e)
    local myData = aData.getData()
    if (myData["AncestralTomb"][e.cell.editorName:lower()] == false) then
        myData["AncestralTomb"][e.cell.editorName:lower()] = true
        myData["AncestralTombCount"] = myData["AncestralTombCount"] + 1
        mwse.log("[Achievement pack] Ancestral Tomb: " .. e.cell.editorName:lower() .. ". Total: " .. myData["AncestralTombCount"] .. "\\88")
    else
        return
    end
end

-- Покоритель глубин.
function aData.countMine(e)
    local myData = aData.getData()
    if (myData["mine"][e.cell.editorName:lower()] == false) then
        myData["mine"][e.cell.editorName:lower()] = true
        myData["mineCount"] = myData["mineCount"] + 1
        mwse.log("[Achievement pack] Mine: " .. e.cell.editorName:lower() .. ". Total: " .. myData["mineCount"] .. "\\43")
    else
        return
    end
end

-- Данмерские крепости.
function aData.countDunmerStr(e)
    local myData = aData.getData()
    if (myData["dunmerStr"][e.cell.editorName:lower()] == false) then
        myData["dunmerStr"][e.cell.editorName:lower()] = true
        myData["dunmerStrCount"] = myData["dunmerStrCount"] + 1
        mwse.log("[Achievement pack] Dunmer Stronghold cell: " .. e.cell.editorName:lower() .. ". Total cel: " .. myData["dunmerStrCount"] .. "\\30")
    else
        return
    end
end

-- Проверка экипировки.
function aData.playerEquip(e)
    if tes3.player.data.achievements.MW_daedricEq and tes3.player.data.achievements.MW_glassEq and tes3.player.data.achievements.MW_adamantiumEq then
    event.unregister(tes3.event.equipped, aData.playerEquip)
    mwse.log("[Achievement pack] playerEquip unregistered")
    return
    end

    if e.reference == tes3.player then
      -- получаем предметы, экипированные в требуемые слоты.
      local bootsEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.boots })
      local leftGauntletEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.leftGauntlet })
      local rightGauntletEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot =tes3.armorSlot.rightGauntlet })
      local helmEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.helmet })
      local cuirassEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.cuirass })
      local greavesEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.greaves })
      local leftPauldronEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.leftPauldron })
      local rightPauldronEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.rightPauldron })
      local shieldEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.shield })
      local leftBracerEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot = tes3.armorSlot.leftBracer })
      local rightBracerEquip = tes3.getEquippedItem({ actor = tes3.player, objectType = tes3.objectType.armor, slot =tes3.armorSlot.rightBracer })
      -- сравниваем ID экипированных предметов с требуемыми.
      -- Прямиком из Забвения (комплект даэдрических доспехов).
      if bootsEquip and bootsEquip.object.id == "daedric_boots"
      and leftGauntletEquip and leftGauntletEquip.object.id == "daedric_gauntlet_left"
      and rightGauntletEquip and rightGauntletEquip.object.id == "daedric_gauntlet_right"
      and helmEquip and (helmEquip.object.id == "daedric_fountain_helm" or helmEquip.object.id == "daedric_god_helm" or helmEquip.object.id == "daedric_terrifying_helm")
      and cuirassEquip and (cuirassEquip.object.id == "daedric_cuirass" or cuirassEquip.object.id == "daedric_cuirass_htab")
      and greavesEquip and (greavesEquip.object.id == "daedric_greaves" or greavesEquip.object.id == "daedric_greaves_htab")
      and leftPauldronEquip and leftPauldronEquip.object.id == "daedric_pauldron_left"
      and rightPauldronEquip and rightPauldronEquip.object.id == "daedric_pauldron_right"
      and shieldEquip and (shieldEquip.object.id == "daedric_shield" or shieldEquip.object.id == "daedric_towershield")
      then
      aData.daedricEq = true
      mwse.log("[Achievement pack] Daedric armor complect equipped.")
      end
      -- Легкий как перышко (комплект стеклянных доспехов).
      if bootsEquip and bootsEquip.object.id == "glass_boots"
      and leftBracerEquip and leftBracerEquip.object.id == "glass_bracer_left"
      and rightBracerEquip and rightBracerEquip.object.id == "glass_bracer_right"
      and helmEquip and helmEquip.object.id == "glass_helm"
      and cuirassEquip and cuirassEquip.object.id == "glass_cuirass"
      and greavesEquip and greavesEquip.object.id == "glass_greaves"
      and leftPauldronEquip and leftPauldronEquip.object.id == "glass_pauldron_left"
      and rightPauldronEquip and rightPauldronEquip.object.id == "glass_pauldron_right"
      and shieldEquip and (shieldEquip.object.id == "glass_shield" or shieldEquip.object.id == "glass_towershield")
      then
      aData.glassEq = true
      mwse.log("[Achievement pack] Glass armor complect equipped.")
      end
      -- Материал Аэдра (комплект адамантиновых доспехов).
      if bootsEquip and bootsEquip.object.id == "adamantium boots"
      and leftBracerEquip and leftBracerEquip.object.id == "adamantium_bracer_left"
      and rightBracerEquip and rightBracerEquip.object.id == "adamantium_bracer_right"
      and helmEquip and (helmEquip.object.id == "adamantium_helm" or helmEquip.object.id == "addamantium_helm")
      and cuirassEquip and cuirassEquip.object.id == "adamantium_cuirass"
      and greavesEquip and greavesEquip.object.id == "adamantium_greaves"
      and leftPauldronEquip and leftPauldronEquip.object.id == "adamantium_pauldron_left"
      and rightPauldronEquip and rightPauldronEquip.object.id == "adamantium_pauldron_right"
      then
      aData.adamantiumEq = true
      mwse.log("[Achievement pack] Adamantium armor complect equipped.")
      end
    end
end

function aData.getData()
    return tes3.player.data.achievePack
end
function aData.initachievePack()
    -- загружаем данные мода из файла сохранения, если отсутствуют, то загружаем значения из таблицы defaults
    local data = tes3.player.data
    data.achievePack = data.achievePack or {}
    local myData = data.achievePack
    initTableValues(myData, defaults)
    -- 36 Уроков Вивека.
    if (myData["VivecLessonsCount"] < 36 and not event.isRegistered(tes3.event.bookGetText, aData.countLessons)) then
        --Thanks to Merlords's Bookworm mod for the idea to use bookGetText here
        event.register(tes3.event.bookGetText, aData.countLessons)
        mwse.log("[Achievement pack] VivecLessonsCount registered")
    end
-- Эхо прошлого.
    if (myData["AncestralTombCount"] < 88 and not event.isRegistered(tes3.event.cellChanged, aData.countTomb)) then
        event.register(tes3.event.cellChanged, aData.countTomb)
        mwse.log("[Achievement pack] AncestralTombCount registered")
    end
-- Покоритель глубин.
    if (myData["mineCount"] < 43 and not event.isRegistered(tes3.event.cellChanged, aData.countMine)) then
        event.register(tes3.event.cellChanged, aData.countMine)
        mwse.log("[Achievement pack] mineCount registered")
    end
-- Данмерские крепости.
    if (myData["dunmerStrCount"] < 30 and not event.isRegistered(tes3.event.cellChanged, aData.countDunmerStr)) then
        event.register(tes3.event.cellChanged, aData.countDunmerStr)
        mwse.log("[Achievement pack] dunmerStrCount registered")
    end
-- Прямиком из Забвения, Легкий как перышко, Материал Аэдра (комплект даэдрических доспехов).
    aData.daedricEq = false
    aData.glassEq = false
    aData.adamantiumEq = false
    if (not tes3.player.data.achievements.MW_daedricEq or not tes3.player.data.achievements.MW_glassEq or not tes3.player.data.achievements.MW_adamantiumEq) and not event.isRegistered(tes3.event.equipped, aData.playerEquip)
    then
        event.register(tes3.event.equipped, aData.playerEquip)
        mwse.log("[Achievement pack] playerEquip registered")
    end

end

return aData
